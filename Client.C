/*
 * client.C
 *
 *  Created on: 11.09.2019
 *      Author: aml
 */

#include <string>
#include <iostream>
#include <unistd.h> //contains various constants
#include <sstream>
#include <vector>

#include "SIMPLESOCKET.H"

#include "IntelliStrat.H"
#include"BruteForce.H"
#include "Random.H"

using namespace std;


void restart(TCPclient c);


int main(int argc, const char **argv) {

	srand(time(NULL));

	int anz; // anzahl der durchlaufe pro Stategie
	sscanf(argv[1],"%i",&anz);
	printf("Parameter : %d ",anz);
	printf("\n");

	int meth;
	sscanf(argv[2],"%i",&meth);
	printf("Strategienummer: %d \n", meth);


	cout << "strategy: ";
	switch(meth){
				case 0: printf("BRUTEFORCE");break;
				case 1: printf("BRUTEFORCEDIAGONAL");break;
				case 2: printf("RANDSHOOT");break;
				case 3: printf("RANDSHOOTIS");break;
				case 4: printf("INTELLISTRAT");break;
				case 5: printf("INTELLISTRATDIAGONAL");break;
				default: printf("Die Strategie existiert nicht.\n");break;exit(0); // Fehlermeldung wird nur einmal erzeugt und nicht anz-mal ausgegeben
				}

	 cout << endl;

	TCPclient c;
	string host = "localhost";

	//connect to host
	c.conn(host , 2021);

	int moves;

	for(int i=0; i<anz; i++){
		switch(meth){
			case 0: moves = BruteForce(c);break;
			case 1: moves = BruteForceDiagonal(c);break;
			case 2: moves = RandShoot(c);break;
			case 3: moves = RandShootiS(c);break;
			case 4: moves = IntelliStrat(c);break;
			case 5: moves = IntelliStratDiagonal(c);break;
			default: printf("Die Strategie existiert nicht.\n");break;exit(0); // Fehlermeldung wird nur einmal erzeugt und nicht anz-mal ausgegeben
			}
	cout << moves << endl;
	moves = 0;
	restart(c);
	}

/*
	int anz; // anzahl der durchlaufe pro Stategie
	sscanf(argv[1],"%i",&anz);
	printf("Parameter : %d",anz);
*/



/*
	vector<pair<string,double>> strategien;
	pair<string,double> strat;
	string stratName;
	double movesAvg = 0.0;
	*/

/*

	//Bruteforce
	for(int i = 0; i< anz;i++){
		if(i==0){
			movesAvg = BruteForce(c);
			restart(c);
		}
		else{
			movesAvg = (movesAvg+BruteForce(c)) /2;
			restart(c);
		}
	}
	strat.first = "BruteForce";
	strat.second = movesAvg;
	strategien.push_back(strat);

	movesAvg = 0.0;
	//BruteforceDiagonal
	for(int i = 0; i< anz;i++){
		if(i==0){
			movesAvg = BruteForceDiagonal(c);
			restart(c);
		}
		else{
			movesAvg = (movesAvg+BruteForceDiagonal(c)) /2;
			restart(c);
		}
	}
	strat.first = "BruteForceDiagonal";
	strat.second = movesAvg;
	strategien.push_back(strat);

	movesAvg = 0.0;
	//Random
	for(int i = 0; i< anz;i++){
		if(i==0){
			movesAvg = RandShoot(c);
			restart(c);
		}
		else{
			movesAvg = (movesAvg+RandShoot(c)) /2;
			restart(c);
		}
	}
	strat.first = "RandomShoot";
	strat.second = movesAvg;
	strategien.push_back(strat);

	//RandomShootiS
		for(int i = 0; i< anz;i++){
			if(i==0){
				movesAvg = RandShootiS(c);
				restart(c);
			}
			else{
				movesAvg = (movesAvg+RandShootiS(c)) /2;
				restart(c);
			}
		}
		strat.first = "RandomShootiS";
		strat.second = movesAvg;
		strategien.push_back(strat);


	movesAvg = 0.0;
	//IntelliStrat
	for(int i = 0; i< anz;i++){
		if(i==0){
			movesAvg = IntelliStrat(c);
			restart(c);
		}
		else{
			movesAvg = (movesAvg+IntelliStrat(c)) /2;
			restart(c);
		}
	}
	strat.first = "IntelliStrat";
	strat.second = movesAvg;
	strategien.push_back(strat);

	movesAvg = 0.0;
	//IntelliStratDiagonal
	for(int i = 0; i< anz;i++){
		if(i==0){
			movesAvg = IntelliStratDiagonal(c);
			restart(c);
		}
		else{
			movesAvg = (movesAvg+IntelliStratDiagonal(c)) /2;
			restart(c);
		}
	}
	strat.first = "IntelliStratDiagonal";
	strat.second = movesAvg;
	strategien.push_back(strat);



	//Ausgabe der Strategien
	cout<<endl<< "----------------"<<endl;
	cout<< "Durchlaeufe pro Strategie: "<<anz<<endl;
	cout<<endl<< "----------"<<endl;
	for(int i = 0 ; i< strategien.size();i++){
		strat = strategien.at(i);
		cout<<endl<< strat.first <<" : "<< strat.second<<endl;
	}
	cout<<endl<< "----------------"<<endl;

*/
	c.sendData("BYEBYE");

}



//Ausgab fehlt noch

void restart(TCPclient c){
	string msg = "RESTART     ";
	cout << "client sends:" << msg << endl;
	c.sendData(msg);
	msg = c.receive(32);

	if(msg.compare(0,9,"RESTARTED")==0) cout<< "got response:" << msg<<endl;
	else{ cout<< "ERROR beim erstellen eines neuen Spieles"<<endl;

	}
}


